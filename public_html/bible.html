<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walk For God – My Personal Bible</title>
    <meta name="description" content="Search the World English Bible (WEB).">
    <link rel="icon" type="image/png" href="images/logo-wfg.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --black: #0a0a0a;
            --black-light: #1a1a1a;
            --gold: #d4af37;
            --gold-light: #f0d77c;
            --purple: #6b4c9a;
            --purple-dark: #4a3470;
            --purple-light: #9d7fd1;
            --heavenly-blue: #4a90d9;
            --heavenly-blue-light: #7ab3eb;
            --cyan: #2bb8b8;
            --white: #ffffff;
            --highlight: #ffff00;
            --highlight-text: #000000;
            --gray-light: #f5f5f5;
            --gray: #888888;
        }

        .highlight {
            background-color: var(--highlight);
            color: var(--highlight-text);
            font-weight: bold;
            padding: 0 2px;
            border-radius: 2px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--black);
            color: var(--white);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Typography */
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(10,10,10,0.95), transparent);
            transition: all 0.3s ease;
        }

        header.scrolled {
            background: rgba(10,10,10,0.98);
            padding: 0.75rem 2rem;
            backdrop-filter: blur(10px);
        }

        /* Logo */
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--white);
        }

        .logo img {
            height: 60px;
            width: auto;
            transition: height 0.3s ease;
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .logo-text small {
            display: block;
            font-size: 0.7rem;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            color: var(--cyan);
            -webkit-text-fill-color: var(--cyan);
        }
        
        /* Menu removed */

        /* Main Content */
        main {
            flex: 1;
            padding-top: 100px;
            padding-bottom: 4rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .page-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-title h1 {
            font-size: clamp(2rem, 4vw, 3rem);
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--white) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-title p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        /* Search Box */
        .search-container {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(10, 10, 10, 0.95) 100%);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .search-rows {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .search-row {
            display: flex;
            gap: 1rem;
            flex-wrap: nowrap;
        }

        .form-group {
            min-width: 100px;
        }

        .form-group.book-group {
            flex: 2;
            min-width: 200px;
        }
        
        .form-group.chapter-group, 
        .form-group.verse-group {
            flex: 0 0 210px;
            min-width: 100px;
        }

        input, select {
            width: 100%;
            padding: 1rem 1.5rem;
            background: rgba(10, 10, 10, 0.6);
            border: 1px solid var(--gold); /* Gold border by default */
            border-radius: 10px;
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        input:focus, select:focus {
            outline: none;
            border: 2px solid var(--gold); /* Bolder border on focus */
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); /* Enhanced glow */
            /* Removed background color change to keep transparent look clean */
            padding: calc(1rem - 1px) calc(1.5rem - 1px);
        }
        
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23d4af37' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1.5rem center;
            background-size: 1.5rem; /* Big arrow */
            padding-right: 4rem; /* Space for the arrow */
        }
        
        /* Fix for IE/Edge default icon hiding if needed, although modern browsers use appearance:none */
        select::-ms-expand {
            display: none;
        }
        
        select option {
            background-color: var(--black);
            color: var(--white);
        }
        select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(255,255,255,0.05);
        }

        button {
            padding: 1rem 3rem;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            color: var(--black);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }

        /* Pagination & Results */
        .pagination-bar {
            display: none;
            justify-content: flex-end;
            align-items: center;
            gap: 1.5rem;
            padding: 0.5rem 0;
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .pagination-bar.bottom {
            margin-top: 1rem;
            margin-bottom: 0;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 1rem;
        }

        .pagination-bar select {
            width: auto;
            padding: 0.3rem 0.5rem;
            margin-left: 0.5rem;
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .icon-btn {
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 1.2rem;
            padding: 0.5rem;
            cursor: pointer;
            width: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .icon-btn:disabled {
            color: rgba(255,255,255,0.2);
            cursor: default;
        }

        .icon-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.1);
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .results-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .verse-card {
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 10px;
            transition: all 0.3s;
            position: relative;
            margin-bottom: 1rem;
        }

        .verse-card.context {
            opacity: 0.6;
            transform: scale(0.98);
        }
        .verse-card.context .verse-text {
            color: var(--gray);
            font-size: 1rem;
        }

        .verse-card.featured {
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid var(--gold);
            border-left: 5px solid var(--gold);
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 10;
        }
        
        .verse-card.featured .verse-text {
            color: var(--white);
            font-weight: 500;
            font-size: 1.3rem;
            line-height: 1.6;
        }
        
        .verse-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-link {
            color: var(--cyan);
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .nav-link:hover {
            color: var(--white);
        }

        .verse-card:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .verse-ref {
            font-family: 'Playfair Display', serif;
            color: var(--gold);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .verse-text {
            color: rgba(255,255,255,0.9);
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .status-msg {
            text-align: center;
            color: var(--gray);
            font-style: italic;
            margin-top: 2rem;
        }

        /* Footer */
        footer {
            background: var(--black-light);
            padding: 3rem 2rem 2rem;
            border-top: 1px solid rgba(212, 175, 55, 0.1);
            margin-top: auto;
            text-align: center;
        }

        .footer-content p {
            color: rgba(255,255,255,0.6);
            font-size: 0.9rem;
        }

        .home-link {
            color: var(--cyan);
            text-decoration: none;
            margin-top: 1rem;
            display: inline-block;
        }
        
        /* Mobile / Tablet Responsiveness */
        @media (max-width: 768px) {
            .search-row {
                flex-wrap: wrap;
            }
            .form-group.book-group, 
            .form-group.chapter-group, 
            .form-group.verse-group {
                flex: 1 1 100%;
            }
            .search-container {
                padding: 1.5rem;
            }
            h1 {
                line-height: 1.3;
            }
            .pagination-bar {
                justify-content: center;
                flex-wrap: wrap;
            }
            .chapter-navigation {
                flex-direction: row; 
                gap: 1rem;
            }
            .chapter-nav-btn {
                flex: 1;
                justify-content: center;
                padding: 0.8rem;
                font-size: 0.9rem;
            }
        }

        /* Chapter Mode Styles */
        .chapter-mode-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
            margin-bottom: 1.5rem;
        }

        .chapter-mode-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
            margin-top: 1.5rem;
        }

        .chapter-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--gold);
        }

        .chapter-controls {
            display: flex;
            gap: 0.5rem;
        }

        .nav-icon-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--white);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
            font-size: 1.2rem;
        }
        
        .nav-icon-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--gold);
            color: var(--gold);
        }

        .chapter-verse {
            margin-bottom: 1rem;
            line-height: 1.8;
            font-size: 1.1rem;
            color: rgba(255,255,255,0.9);
        }

        .verse-num-inline {
            font-weight: bold;
            color: var(--cyan);
            margin-right: 0.5rem;
            font-size: 0.9em;
        }
        
        .footer-nav-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            cursor: pointer;
            transition: color 0.3s;
            font-size: 0.9rem;
        }
        
        .footer-nav-btn:hover {
            color: var(--gold);
        }
        
        .chapter-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .chapter-nav-btn {
            background: rgba(255, 255, 255, 0.05);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .chapter-nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--gold);
        }

        /* Scroll to Top Button (from index.html) */
        .scroll-top-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 45px;
            height: 45px;
            background: var(--gold);
            padding: 0; /* Override global button padding */
            background-image: none; /* Override global button gradient */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: none;
        }

        .scroll-top-btn.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .scroll-top-btn:hover {
            transform: translateY(-3px);
            background: var(--gold-light);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .scroll-top-btn svg {
            width: 24px;
            height: 24px;
            color: var(--black);
            stroke-width: 2.5;
        }

        /* Search Layout Tweaks */
        .text-search-row {
            align-items: center;
        }
        
        .exact-match-label {
            display: flex; 
            align-items: center; 
            gap: 0.8rem; 
            color: var(--gold); 
            font-size: 1.1rem; 
            cursor: pointer; 
            white-space: nowrap;
            min-width: fit-content;
            
            /* Professional styling */
            border: 1px solid var(--gold);
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            background: rgba(212, 175, 55, 0.08); /* Light gold tint */
            transition: all 0.3s ease;
            font-family: 'Playfair Display', serif; /* Matching headers for elegance */
        }
        
        .exact-match-label:hover {
            background: rgba(212, 175, 55, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
        }
        
        .exact-match-label input {
            width: 1.3rem; 
            height: 1.3rem;
            margin: 0;
            box-shadow: none; 
            accent-color: var(--gold);
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .search-row {
                flex-wrap: wrap;
            }
            /* Stack search input and checkbox on mobile */
            .text-search-row {
                flex-direction: column; 
                align-items: flex-start;
                gap: 0.5rem;
            }
            .form-group.book-group, 
            .form-group.chapter-group, 
            .form-group.verse-group {
                flex: 1 1 100%;
            }
            .search-container {
                padding: 1.5rem;
            }
            h1 {
                line-height: 1.3;
            }
            .pagination-bar {
                justify-content: center;
                flex-wrap: wrap;
            }
            /* Chapter Mode Mobile Fixes */
            .chapter-mode-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
                align-items: center;
            }
            .chapter-title {
                font-size: 1.5rem; /* Smaller font for mobile */
                width: 100%;
            }
            .chapter-controls {
                width: 100%;
                justify-content: center;
                gap: 2rem; /* More space between arrows on mobile */
            }
            .nav-icon-btn {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
                flex-shrink: 0; /* Prevent squashing */
            }
            
            /* Footer Nav Buttons */
            .chapter-navigation {
                flex-direction: column; 
                gap: 1rem;
            }
            .chapter-nav-btn {
                width: 100%;
                justify-content: center;
                padding: 0.8rem;
                font-size: 0.9rem;
            }
        }
        /* Info Icon & Modal Styles */
        .info-icon-btn {
            background: transparent;
            border: none;
            color: var(--gold);
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: auto; /* override global button */
            background-image: none; /* override global button */
        }
        .info-icon-btn:hover {
            transform: scale(1.1);
            color: var(--white);
            background: transparent; 
            box-shadow: none;
        }
        .info-icon-btn svg {
            width: 56px;
            height: 56px;
            stroke-width: 1.5;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-content {
            background: var(--black-light);
            border: 1px solid var(--gold);
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-header {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(10, 10, 10, 0) 100%);
            padding: 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: relative;
        }
        .modal-header h2 {
            margin: 0;
            color: var(--gold);
            font-size: 1.8rem;
        }
        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: transparent;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            width: auto;
            padding: 0;
            background-image: none;
        }
        .modal-close:hover {
            color: var(--white);
            transform: rotate(90deg);
        }
        .modal-body {
            padding: 2rem;
            color: rgba(255,255,255,0.9);
        }
        .modal-body h3 {
            color: var(--gold);
            font-family: 'Playfair Display', serif;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(212,175,55,0.3);
            padding-bottom: 0.5rem;
            display: inline-block;
            font-size: 1.3rem;
        }
        .modal-body p, .modal-body li {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            margin-bottom: 1rem;
            color: #ddd;
        }
        .bib-meta {
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            border-left: 3px solid var(--cyan);
        }
        .modal-body ul {
            list-style-type: none;
            padding-left: 0;
        }
        .modal-body li {
            margin-bottom: 1rem;
            padding-left: 1rem;
            border-left: 2px solid rgba(255,255,255,0.1);
        }
        .modal-body strong {
            color: var(--white);
        }

        /* Audio Player Styles */
        .audio-btn {
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-dark) 100%);
            color: var(--white);
            border: none;
            border-radius: 50px;
            padding: 0.4rem 1.2rem;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            margin-bottom: 0;
            width: auto; /* Override global button width */
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(107, 76, 154, 0.3);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            white-space: nowrap;
        }
        .audio-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 76, 154, 0.5);
            background: linear-gradient(135deg, var(--purple-light) 0%, var(--purple) 100%);
        }
        .audio-btn.playing {
            background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo">
            <img src="images/logo-wfg.png" alt="Walk For God Logo">
            <div class="logo-text">
                Walk For God
                <small>My Personal Bible</small>
            </div>
        </a>
        
        <button class="info-icon-btn" onclick="openInfoModal()" title="About Bible" aria-label="About Bible">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
        </button>
    </header>

    <main>
        <div class="container">
            <div class="page-title">
                <h1>My Bible</h1>
            </div>

            <div class="search-container">
                <div class="search-rows">
                    <!-- Row 1: Filters -->
                    <div class="search-row">
                        <div class="form-group book-group">
                            <select id="bookSelect">
                                <option value="">Select Book...</option>
                            </select>
                        </div>
                        <div class="form-group chapter-group">
                            <select id="chapterSelect" disabled>
                                <option value="">Chapter...</option>
                            </select>
                        </div>
                        <div class="form-group verse-group">
                            <select id="verseSelect" disabled>
                                <option value="">Verse...</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Row 2: Text Search -->
                    <div class="search-row text-search-row">
                         <label class="exact-match-label">
                            <input type="checkbox" id="exactMatchCheckbox">
                            Exact match
                        </label>
                        <div class="form-group" style="flex: 1;">
                            <input type="text" id="textInput" placeholder="Search text (e.g. 'Love your neighbor')...">
                        </div>
                    </div>

                    <!-- Row 3: Buttons -->
                    <div class="search-row">
                        <button id="searchBtn" onclick="performSearch()">Search Scripture</button>
                        <button id="resetBtn" onclick="resetSearch()" style="background: transparent; border: 1px solid var(--gold); color: var(--gold); margin-left: 0.5rem;" onmouseover="this.style.background='rgba(212,175,55,0.1)'" onmouseout="this.style.background='transparent'">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Top Pagination -->
            <div class="pagination-bar top" id="topPagination">
                <div class="rows-per-page">
                    Rows per page:
                    <select class="rowsPerPageSelect" onchange="changeRowsPerPage(this.value)">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <div class="pagination-controls">
                    <span class="page-info-text">1-50 of 1000</span>
                    <button class="icon-btn prevBtn" onclick="prevPage()" title="Previous Page">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    </button>
                    <button class="icon-btn nextBtn" onclick="nextPage()" title="Next Page">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </button>
                </div>
            </div>

            <div id="resultsArea" class="results-container">
                <div class="status-msg">Loading Bible data...</div>
            </div>
            
            <!-- Bottom Pagination -->
             <div class="pagination-bar bottom" id="bottomPagination">
                <div class="rows-per-page">
                    Rows per page:
                    <select class="rowsPerPageSelect" onchange="changeRowsPerPage(this.value)">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <div class="pagination-controls">
                    <span class="page-info-text">1-50 of 1000</span>
                    <button class="icon-btn prevBtn" onclick="prevPage()" title="Previous Page">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    </button>
                    <button class="icon-btn nextBtn" onclick="nextPage()" title="Next Page">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2026 Walk For God. All Rights Reserved.</p>
            <a href="index.html" class="home-link">← Back to Home</a>
        </div>
    </footer>

    <!-- Top of Page Button -->
    <button class="scroll-top-btn" id="scrollTopBtn" aria-label="Scroll to top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7 7 7M5 19l7-7 7 7" />
        </svg>
    </button>
    
    <script>
        let bibleData = [];
        // Structure: bibleStructure[BookName][ChapterNumber] = MaxVerses
        let bibleStructure = {}; 
        let isDataLoaded = false;
        
        // Search State
        let currentResults = [];
        let currentPage = 0;
        let rowsPerPage = 50;
        let activeSearchTerm = '';
        let isExactMatch = false;

        // Podcast / Audio State
        let isAutoPlaying = false;
        let currentUtterance = null;
        let appVoices = []; // Cache voices
        let lastSpokenIndex = -1; // Track for continuous reading logic

        // Pre-load voices to ensure consistent selection
        function loadAppVoices() {
            if ('speechSynthesis' in window) {
                appVoices = window.speechSynthesis.getVoices();
            }
        }
        
        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = loadAppVoices;
            // trigger explicitly once
            loadAppVoices();
        }

        // Fetch and Parse CSV
        async function loadBibleData() {
            try {
                const response = await fetch('bible/web.csv');
                if (!response.ok) throw new Error("Failed to load bible file");
                
                const text = await response.text();
                parseCSV(text);
                
                populateBooks();
                document.getElementById('resultsArea').innerHTML = '';
                isDataLoaded = true;
            } catch (err) {
                console.error(err);
                document.getElementById('resultsArea').innerHTML = '<div class="status-msg" style="color: #ff6b6b;">Error loading Bible data. Please try refreshing.</div>';
            }
        }
        
        function parseCSV(csvText) {
            const lines = csvText.split(/\r?\n/);
            // Header is: "Book","Chapter","Verse","Text"
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const parts = line.match(/"([^"]*)"/g);
                
                if (parts && parts.length >= 4) {
                    const book = parts[0].replace(/"/g, '');
                    const chapter = parseInt(parts[1].replace(/"/g, ''));
                    const verse = parseInt(parts[2].replace(/"/g, ''));
                    const text = parts[3].replace(/^"|"$/g, '').trim(); 

                    bibleData.push({ b: book, c: chapter, v: verse, t: text });
                    
                    // Build Structure
                    if (!bibleStructure[book]) {
                        bibleStructure[book] = {};
                    }
                    if (!bibleStructure[book][chapter]) {
                        bibleStructure[book][chapter] = 0;
                    }
                    if (verse > bibleStructure[book][chapter]) {
                        bibleStructure[book][chapter] = verse;
                    }
                }
            }
        }

        function populateBooks() {
            const select = document.getElementById('bookSelect');
            select.innerHTML = '<option value="">Select Book...</option><option value="ALL">ALL BOOKS</option>';
            
            Object.keys(bibleStructure).forEach(book => {
                const opt = document.createElement('option');
                opt.value = book;
                opt.textContent = book;
                select.appendChild(opt);
            });
        }
        
        // Event Listeners for Dynamic Dropdowns
        const bookSelect = document.getElementById('bookSelect');
        const chapterSelect = document.getElementById('chapterSelect');
        const verseSelect = document.getElementById('verseSelect');
        
        bookSelect.addEventListener('change', function() {
            const book = this.value;
            
            // Reset dependent dropdowns
            chapterSelect.innerHTML = '<option value="">Chapter...</option>';
            verseSelect.innerHTML = '<option value="">Verse...</option>';
            verseSelect.disabled = true;
            
            if (book === 'ALL') {
                chapterSelect.disabled = true;
                document.getElementById('textInput').focus();
            } else if (book && bibleStructure[book]) {
                chapterSelect.disabled = false;
                const chapters = Object.keys(bibleStructure[book]).map(Number).sort((a,b) => a - b);
                
                chapters.forEach(chap => {
                    const opt = document.createElement('option');
                    opt.value = chap;
                    opt.textContent = chap;
                    chapterSelect.appendChild(opt);
                });
                
                // Default to Chapter 1
                chapterSelect.value = "1";
                
                // Manually trigger verse population for Chapter 1
                if (bibleStructure[book]["1"]) {
                    verseSelect.disabled = false;
                    const maxVerse = bibleStructure[book]["1"];
                    for(let i=1; i <= maxVerse; i++) {
                        const opt = document.createElement('option');
                        opt.value = i;
                        opt.textContent = i;
                        verseSelect.appendChild(opt);
                    }
                }
            } else {
                chapterSelect.disabled = true;
            }
        });
        
        chapterSelect.addEventListener('change', function() {
            const book = bookSelect.value;
            const chapter = this.value;
            
            // Reset verse
            verseSelect.innerHTML = '<option value="">Verse...</option>';
            
            if (book && book !== 'ALL' && chapter && bibleStructure[book][chapter]) {
                verseSelect.disabled = false;
                const maxVerse = bibleStructure[book][chapter];
                
                for(let i=1; i <= maxVerse; i++) {
                     const opt = document.createElement('option');
                     opt.value = i;
                     opt.textContent = i;
                     verseSelect.appendChild(opt);
                }
            } else {
                verseSelect.disabled = true;
            }
        });

        function resetSearch() {
            stopAudio(); // Ensure audio stops on reset
            document.getElementById('bookSelect').value = "";
            document.getElementById('chapterSelect').innerHTML = '<option value="">Chapter...</option>';
            document.getElementById('chapterSelect').disabled = true;
            document.getElementById('verseSelect').innerHTML = '<option value="">Verse...</option>';
            document.getElementById('verseSelect').disabled = true;
            document.getElementById('textInput').value = "";
            document.getElementById('exactMatchCheckbox').checked = false;
            
            currentResults = [];
            document.querySelectorAll('.pagination-bar').forEach(el => el.style.display = 'none');
            document.getElementById('resultsArea').innerHTML = '';
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function performSearch() {
            if (!isDataLoaded) return;
            
            // Mobile: Scroll to top when search starts to show results/context
            if (window.innerWidth <= 768) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            const sBook = document.getElementById('bookSelect').value;
            const sChap = document.getElementById('chapterSelect').value;
            const sVerse = document.getElementById('verseSelect').value;
            const sTextRaw = document.getElementById('textInput').value.trim();
            const sText = sTextRaw.toLowerCase();
            isExactMatch = document.getElementById('exactMatchCheckbox').checked;
            
            // Set initial active search term
            activeSearchTerm = sTextRaw;
            
            const resultsArea = document.getElementById('resultsArea');
            
            // Hide pagination initially
            document.querySelectorAll('.pagination-bar').forEach(el => el.style.display = 'none');

            // --- Match Helper Function ---
            const checkMatch = (verseText, queryText, isExact) => {
                const vt = verseText.toLowerCase();
                if (!isExact) {
                    return vt.includes(queryText);
                } else {
                    // Exact match: word boundary check
                    // Escape special regex chars in query
                    const escaped = queryText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`\\b${escaped}\\b`, 'i');
                    return regex.test(verseText);
                }
            };

            if (!sBook && !sText) {
                resultsArea.innerHTML = '<div class="status-msg">Please enter a search criterion.</div>';
                return;
            }
            
            if (sBook === 'ALL' && !sText) {
                resultsArea.innerHTML = '<div class="status-msg" style="color: #ff6b6b;">Please enter text to search in "ALL BOOKS".</div>';
                return;
            }

            resultsArea.innerHTML = '<div class="status-msg">Searching...</div>';

            // Filter (Phase 1)
            currentResults = bibleData.filter(item => {
                let match = true;
                if (sBook && sBook !== 'ALL' && item.b !== sBook) match = false;
                if (sChap && item.c != sChap) match = false;
                if (sVerse && item.v != sVerse) match = false;
                if (sText && !checkMatch(item.t, sText, isExactMatch)) match = false;
                return match;
            });
            
            // Auto-correct behavior (UK -> US)
            if (currentResults.length === 0 && sText) {
                // ... (omitted spelling logic for brevity, it remains unchanged) ...
                // Re-inserted full block below to match context
                const spellingMap = {
                    'neighbour': 'neighbor', 'saviour': 'savior', 'honour': 'honor', 'labour': 'labor',
                    'colour': 'color', 'favour': 'favor', 'splendour': 'splendor', 'rumour': 'rumor',
                    'harbour': 'harbor', 'armour': 'armor', 'clamour': 'clamor', 'endeavour': 'endeavor',
                    'parlour': 'parlor', 'vigour': 'vigor', 'valour': 'valor', 'centre': 'center',
                    'theatre': 'theater', 'grey': 'gray'
                };
                let usText = sText; 
                let changed = false;
                let displayTerm = activeSearchTerm;
                
                Object.keys(spellingMap).forEach(uk => {
                    if (usText.includes(uk)) {
                        const regex = new RegExp(uk, 'g');
                        usText = usText.replace(regex, spellingMap[uk]);
                        const dispRegex = new RegExp(uk, 'gi');
                        displayTerm = displayTerm.replace(dispRegex, spellingMap[uk]);
                        changed = true;
                    }
                });

                if (changed) {
                    const retryResults = bibleData.filter(item => {
                        let match = true;
                        if (sBook && sBook !== 'ALL' && item.b !== sBook) match = false;
                        if (sChap && item.c != sChap) match = false;
                        if (sVerse && item.v != sVerse) match = false;
                        if (usText && !checkMatch(item.t, usText, isExactMatch)) match = false;
                        return match;
                    });
                    
                    if (retryResults.length > 0) {
                       currentResults = retryResults;
                       activeSearchTerm = displayTerm; 
                       resultsArea.insertAdjacentHTML('afterbegin', `<div class="status-msg" style="color: var(--gold); font-size: 0.9rem;">Showing results for "${activeSearchTerm}" instead...</div>`);
                    }
                }
            }

            // Reset to page 0
            currentPage = 0;
            displayResults();
            
            // Scroll to results for all devices
            setTimeout(() => {
                const target = document.getElementById('resultsArea');
                // Adjust offset based on screen size if needed, but 100px is generally safe for fixed header
                const headerOffset = 100; 
                const elementPosition = target.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
            
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }, 100);
        }

        function displayResults() {
             const resultsArea = document.getElementById('resultsArea');
             
             if (currentResults.length === 0) {
                 resultsArea.innerHTML = '<div class="status-msg">No results found.</div>';
                 document.querySelectorAll('.pagination-bar').forEach(el => el.style.display = 'none');
                 return;
             }
             
             // Check if we are in "Single Verse Mode" (Book + Chap + Verse selected, NO text search)
             // And ensuring we have exactly one main result (or close to it)
             const sBook = document.getElementById('bookSelect').value;
             const sChap = document.getElementById('chapterSelect').value;
             const sVerse = document.getElementById('verseSelect').value;
             const sText = document.getElementById('textInput').value.trim();
             
             const isSingleVerseMode = (sBook && sBook !== 'ALL' && sChap && sVerse && !sText);
             const isChapterMode = (sBook && sBook !== 'ALL' && sChap && !sVerse && !sText);

             // Reset normal pagination if in single verse mode (we handle nav differently)
             if (isSingleVerseMode && currentResults.length === 1) {
                 document.querySelectorAll('.pagination-bar').forEach(el => el.style.display = 'none');
                 displaySingleVerseWithContext();
                 return;
             }
             
             // --- Consolidated Rendering Logic ---
             
             // Common Render Function (can take a slice or full array)
             const renderVerseList = (verses, container, showFullRef) => {
                 // highlighting regex
                 const searchTerm = activeSearchTerm;
                 let highlightRegex = null;
                 if (searchTerm && searchTerm.length > 0) {
                     const escapedTerm = searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                     highlightRegex = new RegExp(`(${escapedTerm})`, 'gi');
                 }
                 
                 verses.forEach(verse => {
                     let displayText = verse.t;
                     if (highlightRegex) {
                         displayText = displayText.replace(highlightRegex, '<span class="highlight">$1</span>');
                     }
                     
                     const div = document.createElement('div');
                     div.className = 'chapter-verse'; // Unify style to 'chapter-verse' (clean row)
                     div.style.cursor = 'pointer';
                     div.onclick = function() { viewVerse(verse); };
                     
                     // Construct the reference part
                     let refHtml = '';
                     if (showFullRef) {
                         // e.g. "Genesis 1:1"
                         refHtml = `<span class="verse-ref-inline" style="color: var(--gold); font-weight: bold; margin-right: 0.5rem; white-space: nowrap;">${verse.b} ${verse.c}:${verse.v}</span>`;
                     } else {
                         // e.g. "1"
                         refHtml = `<span class="verse-num-inline" style="color: var(--gold); font-weight: bold; margin-right: 0.5rem;">${verse.v}</span>`;
                     }
                     
                     div.innerHTML = `${refHtml}${displayText}`;
                     container.appendChild(div);
                 });
             };

             // --- Chapter Mode (Book + Chap selected) ---
             if (isChapterMode) {
                 document.querySelectorAll('.pagination-bar').forEach(el => el.style.display = 'none');
                 resultsArea.innerHTML = '';
                 
                 // Header
                 const headerDiv = document.createElement('div');
                 headerDiv.className = 'chapter-mode-header';
                 headerDiv.style.flexDirection = 'column';
                 headerDiv.style.alignItems = 'stretch';
                 headerDiv.innerHTML = `
                    <div class="chapter-title" style="text-align: center; margin-bottom: 1rem;">${sBook} ${sChap}</div>
                    <div style="display: flex; justify-content: space-between; width: 100%;">
                        <div class="footer-nav-btn" onclick="goToRelativeChapter(-1)">&lt; Previous Chapter</div>
                        <div class="footer-nav-btn" onclick="goToRelativeChapter(1)">Next Chapter &gt;</div>
                    </div>
                 `;
                 resultsArea.appendChild(headerDiv);

                 // Content
                 const contentDiv = document.createElement('div');
                 contentDiv.className = 'chapter-content';
                 // Render ALL verses for chapter (no pagination usually, or one long page)
                 renderVerseList(currentResults, contentDiv, false); // false = only verse num
                 resultsArea.appendChild(contentDiv);
                 
                 // Footer
                 const footerDiv = document.createElement('div');
                 footerDiv.className = 'chapter-mode-footer';
                 footerDiv.innerHTML = `
                    <div class="footer-nav-btn" onclick="goToRelativeChapter(-1)">&lt; Previous Chapter</div>
                    <div class="footer-nav-btn" onclick="goToRelativeChapter(1)">Next Chapter &gt;</div>
                 `;
                 resultsArea.appendChild(footerDiv);
                 return;
             }
             
             // --- Standard Search / Book Mode ---
             
             // Pagination setup
             document.querySelectorAll('.pagination-bar').forEach(el => el.style.display = 'flex');
             const start = currentPage * rowsPerPage;
             const end = Math.min(start + rowsPerPage, currentResults.length);
             const slice = currentResults.slice(start, end);

             // Note: If BookMode, Header was already added. If not, resultsArea was cleared.
             
             // Create a container for the list if one doesn't exist? 
             // Actually currently we just append to resultsArea. 
             // Let's create a specific container to mirror Chapter Mode structure for consistency?
             // Or just append directly. Direct append is fine.
             
             // Determine if we show full ref. 
             // In Book Mode, we might want "Chapter:Verse" (e.g. 1:1) but maybe "Book 1:1" is safer/easier to read.
             // If standard search, we definitely need "Book C:V".
             // So always show full ref for consistency in these lists.
             
             resultsArea.innerHTML = '';
             renderVerseList(slice, resultsArea, true); // true = Show "Genesis 1:1"
             
             updatePaginationControls(start + 1, end, currentResults.length);
        }

        // ... displaySingleVerseWithContext ...
        
        function goToRelativeChapter(offset) {
            const currentBook = document.getElementById('bookSelect').value;
            const currentChap = parseInt(document.getElementById('chapterSelect').value);
            
            // We need to determine the new Book and Chapter
            let newBook = currentBook;
            let newChap = currentChap + offset;
            
            // Check bounds for current book
            const maxChap = Math.max(...Object.keys(bibleStructure[currentBook]).map(Number));
            
            if (newChap < 1) {
                // Go to previous book?
                // Get list of books
                const books = Object.keys(bibleStructure);
                const bookIdx = books.indexOf(currentBook);
                if (bookIdx > 0) {
                    newBook = books[bookIdx - 1];
                    const prevBookChapters = Object.keys(bibleStructure[newBook]).map(Number);
                    newChap = Math.max(...prevBookChapters); // Last chapter of prev book
                } else {
                    return; // Start of Bible
                }
            } else if (newChap > maxChap) {
                // Go to next book
                const books = Object.keys(bibleStructure);
                const bookIdx = books.indexOf(currentBook);
                if (bookIdx < books.length - 1) {
                    newBook = books[bookIdx + 1];
                    newChap = 1; // First chapter of next book
                } else {
                    return; // End of Bible
                }
            }
            
            // Update UI
            updateSelection(newBook, newChap);
        }
        
        function updateSelection(book, chap) {
             const bookSelect = document.getElementById('bookSelect');
             const chapterSelect = document.getElementById('chapterSelect');
             const verseSelect = document.getElementById('verseSelect');
             
             if (bookSelect.value !== book) {
                 bookSelect.value = book;
                 // Re-populate chapters
                 chapterSelect.innerHTML = '<option value="">Chapter...</option>';
                 const chapters = Object.keys(bibleStructure[book]).map(Number).sort((a,b)=>a-b);
                 chapters.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c; opt.textContent = c; chapterSelect.appendChild(opt);
                 });
                 chapterSelect.disabled = false;
             }
             
             chapterSelect.value = chap;
             
             // Reset verse (since we are in chapter mode)
             verseSelect.innerHTML = '<option value="">Verse...</option>';
             verseSelect.value = "";
             verseSelect.disabled = true; // Wait, if book selected, verse is usually disabled until chap selected. 
             // Logic says: if Book+Chap selected, Verse IS enabled but optional
             
             // Enable verse select with new chapter's verses
             if (book && chap && bibleStructure[book][chap]) {
                 verseSelect.disabled = false;
                 const maxVerse = bibleStructure[book][chap];
                 for(let i=1; i <= maxVerse; i++) {
                     const opt = document.createElement('option');
                     opt.value = i;
                     opt.textContent = i;
                     verseSelect.appendChild(opt);
                 }
             }

             // Trigger Search
             performSearch();
             // Scroll to top
             window.scrollTo({top: 0, behavior: 'smooth'});
        }
        
        // Back to top Logic
        window.addEventListener('scroll', () => {
            const btn = document.getElementById('scrollTopBtn');
            if (window.scrollY > 300) {
                btn.classList.add('show');
            } else {
                btn.classList.remove('show');
            }
            
            // Header scroll effect (matches index.html logic)
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        // Menu Removed as per request

        function viewVerse(verse) {
             const bookSelect = document.getElementById('bookSelect');
             const chapterSelect = document.getElementById('chapterSelect');
             const verseSelect = document.getElementById('verseSelect');
             
             // Update Book
             if (bookSelect.value !== verse.b) {
                 bookSelect.value = verse.b;
                 // Manually populate chapters
                 chapterSelect.innerHTML = '<option value="">Chapter...</option>';
                 const chapters = Object.keys(bibleStructure[verse.b]).map(Number).sort((a,b)=>a-b);
                 chapters.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c; opt.textContent = c; chapterSelect.appendChild(opt);
                 });
                 chapterSelect.disabled = false;
             }
             
             chapterSelect.value = verse.c;
             
             // Populate Verses
             verseSelect.innerHTML = '<option value="">Verse...</option>';
             if (bibleStructure[verse.b] && bibleStructure[verse.b][verse.c]) {
                 const maxVerse = bibleStructure[verse.b][verse.c];
                 for(let i=1; i<=maxVerse; i++) {
                     const opt = document.createElement('option');
                     opt.value = i; opt.textContent = i; verseSelect.appendChild(opt);
                 }
                 verseSelect.disabled = false;
             }
             verseSelect.value = verse.v;
             
             // Clear text search to satisfy isSingleVerseMode
             document.getElementById('textInput').value = "";
             
             performSearch();
             window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function displaySingleVerseWithContext() {
            const resultsArea = document.getElementById('resultsArea');
            resultsArea.innerHTML = '';
            
            // The result is currentResults[0]
            const targetVerse = currentResults[0];
            
            // Find index in full Bible Data to get context
            // Optimization: We could store index, but finding it is fast enough
            const index = bibleData.findIndex(item => 
                item.b === targetVerse.b && item.c === targetVerse.c && item.v === targetVerse.v
            );
            
            if (index === -1) return; // Should not happen
            
            // Get Prev Verse
            if (index > 0) {
                const prev = bibleData[index - 1];
                const div = document.createElement('div');
                div.className = 'verse-card context';
                div.innerHTML = `
                    <span class="verse-ref">${prev.b} ${prev.c}:${prev.v}</span>
                    <div class="verse-text">${prev.t}</div>
                `;
                resultsArea.appendChild(div);
            }
            
            // Get Target Verse (Featured)
            const div = document.createElement('div');
            div.className = 'verse-card featured';
            
            // Audio Button HTML
            const btnLabel = isAutoPlaying ? 'Stop' : 'Play';
            const btnClass = isAutoPlaying ? 'audio-btn playing' : 'audio-btn';
            const btnIcon = isAutoPlaying 
                ? '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>' 
                : '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>';

            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: nowrap; gap: 1rem;">
                    <span class="verse-ref" style="margin-bottom: 0;">${targetVerse.b} ${targetVerse.c}:${targetVerse.v}</span>
                    <button class="${btnClass}" onclick="toggleVerseAudio(${index})">
                        ${btnIcon}
                        ${btnLabel}
                    </button>
                </div>
                <div class="verse-text">${targetVerse.t}</div>
                
                <div class="verse-navigation">
                     <div class="nav-link" onclick="stopAudio(); goToVerse(${index - 1})">
                        &larr; Prev
                     </div>
                     <div class="nav-link" onclick="stopAudio(); goToVerse(${index + 1})">
                        Next &rarr;
                     </div>
                </div>
            `;
            resultsArea.appendChild(div);
            
            // Get Next Verse
            if (index < bibleData.length - 1) {
                const next = bibleData[index + 1];
                const divNext = document.createElement('div');
                divNext.className = 'verse-card context';
                divNext.innerHTML = `
                    <span class="verse-ref">${next.b} ${next.c}:${next.v}</span>
                    <div class="verse-text">${next.t}</div>
                `;
                resultsArea.appendChild(divNext);
            }

            // Auto-Play Logic
            if (isAutoPlaying) {
                // Introduce a tiny delay to ensure DOM is ready and prevent instant loop issues
                setTimeout(() => speakCurrentVerse(index), 300);
            }
        }
        
        function goToVerse(index) {
            if (index < 0 || index >= bibleData.length) return;
            
            const nextVerse = bibleData[index];
            
            // Update Dropdowns to match new verse
            const bookSelect = document.getElementById('bookSelect');
            const chapterSelect = document.getElementById('chapterSelect');
            const verseSelect = document.getElementById('verseSelect');
            
            // Set Book
            bookSelect.value = nextVerse.b;
            // Trigger change manual? We can just set internal state if we want, but better to update UI
            
            // We need to re-populate chapter dropdown if book changed, but since we are just navigating,
            // let's cheat and just set the currentResult to this new verse and re-render standard text.
            // BUT proper way is to update the UI controls so the user sees where they are.
            
            // 1. Update UI (Simpler approach: just update filtering logic params temporarily or force update)
            // Let's manually trigger the updates
            
            // Only update book if changed
            if (bookSelect.value !== nextVerse.b) {
                // Populate chapters for new book
                chapterSelect.innerHTML = '<option value="">Chapter...</option>';
                verseSelect.innerHTML = '<option value="">Verse...</option>';
                const chapters = Object.keys(bibleStructure[nextVerse.b]).map(Number).sort((a,b)=>a-b);
                chapters.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c; opt.textContent = c; chapterSelect.appendChild(opt);
                });
                chapterSelect.disabled = false;
            }
            
            chapterSelect.value = nextVerse.c;
            
            // Update verses
             verseSelect.innerHTML = '<option value="">Verse...</option>';
             const maxVerse = bibleStructure[nextVerse.b][nextVerse.c];
             for(let i=1; i<=maxVerse; i++){
                 const opt = document.createElement('option');
                 opt.value = i; opt.textContent = i; verseSelect.appendChild(opt);
             }
             verseSelect.disabled = false;
             verseSelect.value = nextVerse.v;
             
             // Perform Search
             performSearch();
        }

        function goToRelativeChapter(offset) {
            const currentBook = document.getElementById('bookSelect').value;
            const currentChap = parseInt(document.getElementById('chapterSelect').value);
            
            // We need to determine the new Book and Chapter
            let newBook = currentBook;
            let newChap = currentChap + offset;
            
            // Check bounds for current book
            const maxChap = Math.max(...Object.keys(bibleStructure[currentBook]).map(Number));
            
            if (newChap < 1) {
                // Go to previous book?
                // Get list of books
                const books = Object.keys(bibleStructure);
                const bookIdx = books.indexOf(currentBook);
                if (bookIdx > 0) {
                    newBook = books[bookIdx - 1];
                    const prevBookChapters = Object.keys(bibleStructure[newBook]).map(Number);
                    newChap = Math.max(...prevBookChapters); // Last chapter of prev book
                } else {
                    return; // Start of Bible
                }
            } else if (newChap > maxChap) {
                // Go to next book
                const books = Object.keys(bibleStructure);
                const bookIdx = books.indexOf(currentBook);
                if (bookIdx < books.length - 1) {
                    newBook = books[bookIdx + 1];
                    newChap = 1; // First chapter of next book
                } else {
                    return; // End of Bible
                }
            }
            
            // Update UI
            updateSelection(newBook, newChap);
        }
        
        function updateSelection(book, chap) {
             const bookSelect = document.getElementById('bookSelect');
             const chapterSelect = document.getElementById('chapterSelect');
             const verseSelect = document.getElementById('verseSelect');
             
             if (bookSelect.value !== book) {
                 bookSelect.value = book;
                 // Re-populate chapters
                 chapterSelect.innerHTML = '<option value="">Chapter...</option>';
                 const chapters = Object.keys(bibleStructure[book]).map(Number).sort((a,b)=>a-b);
                 chapters.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c; opt.textContent = c; chapterSelect.appendChild(opt);
                 });
                 chapterSelect.disabled = false;
             }
             
             chapterSelect.value = chap;
             
             // Reset verse (since we are in chapter mode)
             verseSelect.innerHTML = '<option value="">Verse...</option>';
             verseSelect.value = "";
             verseSelect.disabled = true; // Wait, if book selected, verse is usually disabled until chap selected. 
             // Logic says: if Book+Chap selected, Verse IS enabled but optional
             
             // Enable verse select with new chapter's verses
             if (book && chap && bibleStructure[book][chap]) {
                 verseSelect.disabled = false;
                 const maxVerse = bibleStructure[book][chap];
                 for(let i=1; i <= maxVerse; i++) {
                     const opt = document.createElement('option');
                     opt.value = i;
                     opt.textContent = i;
                     verseSelect.appendChild(opt);
                 }
             }

             // Trigger Search
             performSearch();
             // Scroll to top
             window.scrollTo({top: 0, behavior: 'smooth'});
        }
        
        function updatePaginationControls(start, end, total) {
            const text = `${start}-${end} of ${total}`;
            
            // Text updates
            document.querySelectorAll('.page-info-text').forEach(el => el.textContent = text);
            
            // Dropdown updates
            document.querySelectorAll('.rowsPerPageSelect').forEach(el => el.value = rowsPerPage);
            
            // Button states
            const prevDisabled = currentPage === 0;
            const nextDisabled = end >= total;
            
            document.querySelectorAll('.prevBtn').forEach(btn => btn.disabled = prevDisabled);
            document.querySelectorAll('.nextBtn').forEach(btn => btn.disabled = nextDisabled);
        }
        
        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                displayResults();
                scrollToTop();
            }
        }
        
        function nextPage() {
            const maxPage = Math.ceil(currentResults.length / rowsPerPage) - 1;
            if (currentPage < maxPage) {
                currentPage++;
                displayResults();
                scrollToTop();
            }
        }
        
        function changeRowsPerPage(val) {
            rowsPerPage = parseInt(val);
            currentPage = 0; // Reset to start
            displayResults();
        }
        
        function scrollToTop() {
             const searchContainer = document.querySelector('.search-container');
             if (searchContainer) searchContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        /* --- Audio / Text-to-Speech Functions --- */

        function toggleVerseAudio(index) {
            if (isAutoPlaying) {
                stopAudio();
                // Re-render to show "Play" button
                displaySingleVerseWithContext(); 
            } else {
                isAutoPlaying = true;
                displaySingleVerseWithContext(); // Re-render to show "Stop" button immediately
                // The auto-play logic inside displaySingleVerseWithContext will trigger speakCurrentVerse
            }
        }

        function stopAudio() {
            isAutoPlaying = false;
            lastSpokenIndex = -1; // Reset continuous tracker
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }
        }

        function speakCurrentVerse(index) {
            if (!isAutoPlaying) return;
            if (!window.speechSynthesis) {
                alert("Sorry, your browser does not support text-to-speech.");
                stopAudio();
                displaySingleVerseWithContext();
                return;
            }

            // Ensure we have the latest voices
            if (appVoices.length === 0) {
                appVoices = window.speechSynthesis.getVoices();
            }

            // Get verse data
            const verse = bibleData[index];
            
            // Logic for Continuous Reading
            let textPrefix = "";
            let textToRead = "";

            // If this is a direct continuation (index is exactly next)
            if (lastSpokenIndex !== -1 && index === lastSpokenIndex + 1) {
                const prevVerse = bibleData[lastSpokenIndex];
                if (prevVerse.b !== verse.b) {
                     // New Book
                     textPrefix = `${verse.b} Chapter ${verse.c}. `; 
                } else if (prevVerse.c !== verse.c) {
                     // New Chapter
                     textPrefix = `Chapter ${verse.c}. `;
                }
                // Else: Same chapter, just read text (no "Verse X")
            } else {
                // Manual Start or Jump -> Announce Full Reference
                textPrefix = `${verse.b} Chapter ${verse.c} Verse ${verse.v}. `;
            }
            
            // Update tracker
            lastSpokenIndex = index;

            textToRead = textPrefix + verse.t;

            // Cancel any previous
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(textToRead);
            utterance.rate = 0.9; // Slightly slower for scripture
            utterance.pitch = 1.0;
            
            // Prioritize Female Voices:
            // 1. Google US English (High quality Female on Chrome)
            // 2. Microsoft Zira (Standard Windows Female)
            // 3. Samantha (Standard Mac Female)
            // 4. Any voice explicitly named "Female"
            const preferredVoice = appVoices.find(v => v.name.includes("Google US English")) || 
                                   appVoices.find(v => v.name.includes("Zira")) ||
                                   appVoices.find(v => v.name.includes("Samantha")) ||
                                   appVoices.find(v => v.name.toLowerCase().includes("female")) ||
                                   appVoices.find(v => v.lang === "en-US"); // Fallback to en-US

            if (preferredVoice) {
                utterance.voice = preferredVoice;
            }

            utterance.onend = function(event) {
                if (isAutoPlaying) {
                    // Navigate to next verse
                    if (index < bibleData.length - 1) {
                        goToVerse(index + 1);
                    } else {
                        stopAudio();
                        displaySingleVerseWithContext(); // Reset UI
                    }
                }
            };

            utterance.onerror = function(event) {
                console.error("Speech error", event);
                stopAudio();
                displaySingleVerseWithContext();
            };

            window.speechSynthesis.speak(utterance);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadBibleData);

        // Allow Enter key to trigger search
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
        });

        // Info Modal Functions
        function openInfoModal() {
            document.getElementById('infoModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeInfoModal() {
            document.getElementById('infoModal').classList.remove('active');
            document.body.style.overflow = ''; 
        }

        // Close modal on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeInfoModal();
            }
        });
    </script>
    <!-- Information Modal -->
    <div class="modal-overlay" id="infoModal" onclick="if(event.target === this) closeInfoModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>About This Bible</h2>
                <button class="modal-close" onclick="closeInfoModal()" aria-label="Close Modal" title="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="bib-meta">
                    <strong>World English Bible (WEB)</strong><br>
                    Published: 2000 (updated continuously)<br>
                    Translator: Rainbow Missions, Inc. (led by Michael Paul Johnson)
                </div>

                <h3>The Core Philosophy</h3>
                <p>The WEB was created to solve a legal problem, not a theological one. Almost all modern English Bibles (NIV, ESV, NKJV) are copyrighted, meaning you cannot print them, display them on websites, or build apps with them without paying royalties or strictly limiting how many verses you quote. The WEB is a Public Domain translation, meaning it is completely free for anyone to use, copy, or publish without permission.</p>

                <h3>Key Characteristics</h3>
                <ul>
                    <li>
                        <strong>God's Name:</strong> It is one of the few English Bibles to use <strong>Yahweh</strong> in the Old Testament instead of the traditional capitalised "LORD." <br><em>(Note: In this application, "Yahweh" has been standardized to "Yehovah" as per site preferences).</em>
                    </li>
                    <li>
                        <strong>Majority Text:</strong> Unlike most modern Bibles (which use the "Critical Text" or "Alexandrian" Greek manuscripts), the WEB New Testament is based on the <strong>Byzantine Majority Text</strong>. This means it includes verses often relegated to footnotes in other Bibles (like Acts 8:37 or the longer ending of Mark).
                    </li>
                    <li>
                        <strong>Modern English:</strong> It is based on the American Standard Version (ASV) of 1901, but the language has been updated to remove "thee," "thou," and archaic grammar, making it readable for modern English speakers.
                    </li>
                </ul>

                <h3>Who uses it?</h3>
                <p>It is widely used by software developers, website creators, and missionaries who need a royalty-free Bible for apps and projection software. If you see a Bible verse on a random website or free app, there is a high chance it is the WEB because of its open license.</p>
            </div>
        </div>
    </div>
</body>
</html>
